<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Finance Pro Premium</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        :root {
            --primary: #1A73E8; --success: #00897B; --danger: #D32F2F;
            --bg: #F8F9FA; --surface: #FFFFFF; --shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; -webkit-tap-highlight-color: transparent; }
        body, html { height: 100%; width: 100%; overflow: hidden; background-color: var(--bg); color: #202124; }

        /* Login Screen */
        #login-screen { position: fixed; inset: 0; background: white; z-index: 5000; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; }
        .login-btn { background: var(--primary); color: white; border: none; padding: 16px 35px; border-radius: 50px; font-weight: bold; font-size: 16px; margin-top: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); cursor: pointer; }

        /* App Layout */
        #app-content { display: none; }
        .header { background: linear-gradient(135deg, #1A73E8, #0D47A1); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; position: fixed; top: 0; width: 100%; z-index: 1000; box-shadow: var(--shadow); }
        
        /* Dashboard Container */
        .dashboard { position: fixed; top: 55px; width: 100%; padding: 20px 15px; background: var(--bg); z-index: 900; }
        .main-card { background: white; padding: 20px; border-radius: 20px; text-align: center; box-shadow: var(--shadow); margin-bottom: 12px; }
        .main-card h1 { font-size: 32px; color: var(--primary); margin-top: 5px; }
        
        .stats-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-box { background: white; padding: 12px; border-radius: 15px; box-shadow: var(--shadow); border-bottom: 4px solid #ddd; }

        /* Scrollable History Area */
        .history-list { position: absolute; top: 270px; bottom: 85px; width: 100%; overflow-y: auto; padding: 10px 15px; -webkit-overflow-scrolling: touch; }
        .tx-card { background: white; padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 6px solid #ccc; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }

        /* Navigation & Actions */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; display: flex; gap: 12px; padding: 15px; background: white; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); z-index: 1000; }
        .btn { flex: 1; border: none; padding: 18px; border-radius: 14px; color: white; font-size: 16px; font-weight: bold; cursor: pointer; }

        /* Premium Modals */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 2000; justify-content: center; align-items: center; }
        .modal { background: white; width: 85%; padding: 25px; border-radius: 20px; animation: pop 0.3s ease-out; }
        @keyframes pop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        input { width: 100%; padding: 15px; margin: 10px 0; border: 1.5px solid #eee; border-radius: 12px; font-size: 16px; background: #F8F9FA; outline: none; }
        input:focus { border-color: var(--primary); background: white; }
    </style>
</head>
<body>

    <div id="login-screen">
        <h1 style="color:var(--primary); font-size: 36px;">Finance Pro</h1>
        <p style="color:#666; margin-top: 10px;">Cloud Money Tracker</p>
        <button class="login-btn" onclick="window.login()">LOGIN WITH GOOGLE</button>
        <p id="auth-status" style="margin-top:20px; color:red; font-size:12px;"></p>
    </div>

    <div id="app-content">
        <div class="header">
            <h3 id="user-display">Finance Pro</h3>
            <div onclick="window.downloadPDF()" style="cursor:pointer; font-size:24px;">ðŸ“„</div>
        </div>

        <div class="dashboard">
            <div class="main-card">
                <small style="color:#666; font-weight:bold; letter-spacing:1px;">TODAY'S NET PROFIT</small>
                <h1 id="today-net">â‚¹0</h1>
            </div>
            <div class="stats-row">
                <div class="stat-box" style="border-color:var(--success)"><small>MONTH INCOME</small><br><span id="m-inc" style="color:var(--success); font-weight:bold;">â‚¹0</span></div>
                <div class="stat-box" style="border-color:var(--danger)"><small>MONTH EXPENSE</small><br><span id="m-exp" style="color:var(--danger); font-weight:bold;">â‚¹0</span></div>
            </div>
        </div>

        <div class="history-list" id="transaction-logs"></div>

        <div class="bottom-nav">
            <button class="btn" style="background:var(--success)" onclick="window.openM('earning')">EARNING</button>
            <button class="btn" style="background:var(--danger)" onclick="window.openM('expense')">EXPENSE</button>
        </div>
    </div>

    <div id="modalBox" class="overlay">
        <div class="modal">
            <h3 id="mHeading">Entry</h3>
            <input type="number" id="amtInput" placeholder="Amount (â‚¹)" inputmode="decimal">
            <input type="text" id="descInput" placeholder="Kaha se? / Kis liye?">
            <button class="btn" style="background:var(--primary); width:100%; margin-top:10px;" onclick="window.saveData()">SAVE ENTRY</button>
            <p onclick="window.closeM()" style="text-align:center; color:#999; margin-top:15px; cursor:pointer;">Cancel</p>
        </div>
    </div>

    <div id="deleteModal" class="overlay">
        <div class="modal" style="text-align:center;">
            <h3>Delete Entry?</h3>
            <p style="color:#666; font-size:14px; margin-top:10px;">Kya aap is entry ko Cloud se delete karna chahte hain?</p>
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button style="flex:1; padding:12px; border:none; border-radius:10px; background:#eee;" onclick="window.closeDelete()">NO</button>
                <button style="flex:1; padding:12px; border:none; border-radius:10px; background:var(--danger); color:white; font-weight:bold;" id="confirmDelBtn">YES, DELETE</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithRedirect, getRedirectResult, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, where, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCq6ZTCMeAGhqKH7cZ3d8gn1JSjn7MFkHg",
            authDomain: "finance-pro-a58ef.firebaseapp.com",
            projectId: "finance-pro-a58ef",
            storageBucket: "finance-pro-a58ef.firebasestorage.app",
            messagingSenderId: "441176545235",
            appId: "1:441176545235:web:5aa38eaf789b6e5ce1c126"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        
        let currentUser = null;
        let transactions = [];
        let currentMode = '';

        // Authentication Logic (Redirect for better Mobile/GitHub compatibility)
        window.login = () => signInWithRedirect(auth, provider);

        getRedirectResult(auth).catch(e => {
            document.getElementById('auth-status').innerText = "Login error: " + e.message;
        });

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-content').style.display = 'block';
                document.getElementById('user-display').innerText = "Hello, " + user.displayName.split(' ')[0];
                startSync();
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('app-content').style.display = 'none';
            }
        });

        // Cloud Data Sync
        function startSync() {
            // Indexing error avoid karne ke liye sirf uid query use kar rahe hain
            const q = query(collection(db, "transactions"), where("uid", "==", currentUser.uid), orderBy("timestamp", "desc"));
            onSnapshot(q, (snap) => {
                transactions = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderUI();
            }, (error) => {
                console.error("Firestore Error:", error);
                if(error.code === 'permission-denied') alert("Check Firestore Rules: Read/Write permission restricted.");
            });
        }

        // UI Controls
        window.openM = (t) => { currentMode = t; document.getElementById('mHeading').innerText = t === 'earning' ? 'Add Income' : 'Add Expense'; document.getElementById('modalBox').style.display = 'flex'; };
        window.closeM = () => { document.getElementById('modalBox').style.display = 'none'; };

        window.saveData = async () => {
            const amt = parseFloat(document.getElementById('amtInput').value);
            const desc = document.getElementById('descInput').value || 'General';
            if(!amt) return;
            try {
                await addDoc(collection(db, "transactions"), { 
                    amount: amt, 
                    type: currentMode, 
                    desc: desc, 
                    timestamp: new Date().toISOString(), 
                    uid: currentUser.uid 
                });
                window.closeM();
                document.getElementById('amtInput').value = ''; document.getElementById('descInput').value = '';
            } catch (e) { alert("Save failed: Check Database Rules!"); }
        };

        window.askDelete = (id) => {
            document.getElementById('deleteModal').style.display = 'flex';
            document.getElementById('confirmDelBtn').onclick = async () => {
                await deleteDoc(doc(db, "transactions", id));
                window.closeDelete();
            };
        };
        window.closeDelete = () => document.getElementById('deleteModal').style.display = 'none';

        function renderUI() {
            const list = document.getElementById('transaction-logs');
            list.innerHTML = '';
            const todayStr = new Date().toDateString();
            const thisM = new Date().getMonth();
            const thisY = new Date().getFullYear();
            let todayNet = 0, mInc = 0, mExp = 0;

            transactions.forEach(i => {
                const dt = new Date(i.timestamp);
                const isToday = dt.toDateString() === todayStr;
                const isMonth = dt.getMonth() === thisM && dt.getFullYear() === thisY;

                if(i.type === 'earning') {
                    if(isToday) todayNet += i.amount;
                    if(isMonth) mInc += i.amount;
                } else {
                    if(isToday) todayNet -= i.amount;
                    if(isMonth) mExp += i.amount;
                }

                const card = document.createElement('div');
                card.className = 'tx-card'; card.style.borderLeftColor = i.type === 'earning' ? 'var(--success)' : 'var(--danger)';
                card.innerHTML = `
                    <div><b>${i.desc}</b><br><small>${dt.toLocaleDateString('en-IN')}</small></div>
                    <div style="display:flex;align-items:center;gap:15px">
                        <span style="font-weight:bold;color:${i.type==='earning'?'var(--success)':'var(--danger)'}">
                            ${i.type==='earning'?'+':'-'} â‚¹${i.amount.toLocaleString()}
                        </span>
                        <span onclick="window.askDelete('${i.id}')" style="color:#ddd;font-size:24px;cursor:pointer;">Ã—</span>
                    </div>`;
                list.appendChild(card);
            });
            document.getElementById('today-net').innerText = "â‚¹" + todayNet.toLocaleString();
            document.getElementById('m-inc').innerText = "â‚¹" + mInc.toLocaleString();
            document.getElementById('m-exp').innerText = "â‚¹" + mExp.toLocaleString();
        }

        window.downloadPDF = () => {
            const { jsPDF } = window.jspdf; const doc = new jsPDF();
            doc.text(`${currentUser.displayName}'s Monthly Report`, 14, 15);
            const rows = transactions.map(i => [new Date(i.timestamp).toLocaleDateString(), i.desc, i.type.toUpperCase(), i.amount]);
            doc.autoTable({ head: [['Date', 'Description', 'Type', 'Amount']], body: rows, startY: 25 });
            doc.save("Finance_Report.pdf");
        };
    </script>
</body>
</html>
