<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Finance Pro Online</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        :root {
            --primary: #1A73E8;
            --success: #00897B;
            --danger: #D32F2F;
            --bg: #F8F9FA;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; }
        body, html { height: 100%; width: 100%; overflow: hidden; background-color: var(--bg); }

        /* Premium UI Elements */
        .header { background: linear-gradient(135deg, #1A73E8 0%, #0D47A1 100%); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; position: fixed; top:0; width:100%; z-index:1000; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .dashboard { position: fixed; top: 55px; width: 100%; padding: 20px 15px; background: var(--bg); z-index: 900; }
        .main-card { background: white; padding: 20px; border-radius: 20px; text-align: center; box-shadow: var(--shadow); margin-bottom: 12px; }
        .main-card h1 { color: var(--primary); font-size: 32px; }
        .stats-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-box { background: white; padding: 12px; border-radius: 15px; box-shadow: var(--shadow); border-bottom: 4px solid #ddd; }
        
        /* Scrollable Area */
        .history-list { position: absolute; top: 260px; bottom: 85px; width: 100%; overflow-y: auto; padding: 10px 15px; -webkit-overflow-scrolling: touch; }
        .tx-card { background: white; padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.03); border-left: 6px solid #ccc; }

        /* Actions */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; display: flex; gap: 12px; padding: 15px; background: white; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); }
        .btn { flex: 1; border: none; padding: 16px; border-radius: 14px; color: white; font-size: 16px; font-weight: bold; }
        
        /* Modal */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; }
        .modal { background: white; width: 85%; padding: 25px; border-radius: 20px; }
        input { width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; }
    </style>
</head>
<body>

    <div class="header">
        <h3>Finance Pro Online</h3>
        <div onclick="window.downloadPDF()" style="cursor:pointer; font-size:20px;">ðŸ“„</div>
    </div>

    <div class="dashboard">
        <div class="main-card">
            <small style="color:#666; font-weight:bold;">TODAY'S BALANCE</small>
            <h1 id="today-net">â‚¹0</h1>
        </div>
        <div class="stats-row">
            <div class="stat-box" style="border-color:var(--success)">
                <small>MONTH INCOME</small><br><span id="m-inc" style="color:var(--success); font-weight:bold;">â‚¹0</span>
            </div>
            <div class="stat-box" style="border-color:var(--danger)">
                <small>MONTH EXPENSE</small><br><span id="m-exp" style="color:var(--danger); font-weight:bold;">â‚¹0</span>
            </div>
        </div>
    </div>

    <div class="history-list" id="transaction-logs">
        <p style="text-align:center; color:#999; margin-top:20px;">Loading data from Firebase...</p>
    </div>

    <div class="bottom-nav">
        <button class="btn" style="background:var(--success)" onclick="window.openM('earning')">EARNING</button>
        <button class="btn" style="background:var(--danger)" onclick="window.openM('expense')">EXPENSE</button>
    </div>

    <div id="modalBox" class="overlay">
        <div class="modal">
            <h3 id="mTitle">Entry</h3>
            <input type="number" id="amtInput" placeholder="Amount (â‚¹)" inputmode="decimal">
            <input type="text" id="descInput" placeholder="Kahan se? / Kis liye?">
            <button class="btn" style="background:var(--primary); width:100%; margin-top:10px;" onclick="window.saveToFirebase()">SAVE TO CLOUD</button>
            <p onclick="window.closeM()" style="text-align:center; color:#999; margin-top:15px; cursor:pointer;">Cancel</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCq6ZTCMeAGhqKH7cZ3d8gn1JSjn7MFkHg",
            authDomain: "finance-pro-a58ef.firebaseapp.com",
            projectId: "finance-pro-a58ef",
            storageBucket: "finance-pro-a58ef.firebasestorage.app",
            messagingSenderId: "441176545235",
            appId: "1:441176545235:web:5aa38eaf789b6e5ce1c126",
            measurementId: "G-QW5FDK98R4"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const txCol = collection(db, "transactions");

        let currentTransactions = [];
        let mode = '';

        // UI Functions globally accessible
        window.openM = (t) => {
            mode = t;
            document.getElementById('mTitle').innerText = t === 'earning' ? 'Add Earning' : 'Add Expense';
            document.getElementById('modalBox').style.display = 'flex';
        };

        window.closeM = () => {
            document.getElementById('modalBox').style.display = 'none';
        };

        window.saveToFirebase = async () => {
            const amt = parseFloat(document.getElementById('amtInput').value);
            const dsc = document.getElementById('descInput').value || 'General';
            if(!amt) return;

            try {
                await addDoc(txCol, {
                    amount: amt,
                    type: mode,
                    desc: dsc,
                    timestamp: new Date().toISOString()
                });
                window.closeM();
                document.getElementById('amtInput').value = '';
                document.getElementById('descInput').value = '';
            } catch (e) { alert("Error saving: " + e.message); }
        };

        window.deleteTx = async (id) => {
            if(confirm("Cloud se delete karein?")) {
                await deleteDoc(doc(db, "transactions", id));
            }
        };

        // Real-time Data Sync
        const q = query(txCol, orderBy("timestamp", "desc"));
        onSnapshot(q, (snapshot) => {
            currentTransactions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            updateUI();
        });

        function updateUI() {
            const logs = document.getElementById('transaction-logs');
            logs.innerHTML = '';
            
            const today = new Date().toDateString();
            const thisM = new Date().getMonth();
            let tNet = 0, mInc = 0, mExp = 0;

            currentTransactions.forEach(i => {
                const dt = new Date(i.timestamp);
                const isT = dt.toDateString() === today;
                const isM = dt.getMonth() === thisM;

                if(i.type === 'earning') {
                    if(isT) tNet += i.amount;
                    if(isM) mInc += i.amount;
                } else {
                    if(isT) tNet -= i.amount;
                    if(isM) mExp += i.amount;
                }

                const d = document.createElement('div');
                d.className = 'tx-card';
                d.style.borderLeftColor = i.type === 'earning' ? 'var(--success)' : 'var(--danger)';
                d.innerHTML = `
                    <div><b>${i.desc}</b><br><small>${dt.toLocaleDateString()}</small></div>
                    <div style="display:flex; align-items:center; gap:12px">
                        <span style="font-weight:bold; color:${i.type === 'earning' ? 'var(--success)' : 'var(--danger)'}">
                            ${i.type === 'earning' ? '+' : '-'} â‚¹${i.amount}
                        </span>
                        <span onclick="window.deleteTx('${i.id}')" style="color:#ddd; font-size:24px;">Ã—</span>
                    </div>`;
                logs.appendChild(d);
            });

            document.getElementById('today-net').innerText = "â‚¹" + tNet;
            document.getElementById('m-inc').innerText = "â‚¹" + mInc;
            document.getElementById('m-exp').innerText = "â‚¹" + mExp;
        }

        // PDF Logic
        window.downloadPDF = () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text("Cloud Finance Report", 14, 15);
            const rows = currentTransactions.map(i => [new Date(i.timestamp).toLocaleDateString(), i.desc, i.type.toUpperCase(), i.amount]);
            doc.autoTable({ head: [['Date', 'Description', 'Type', 'Amount']], body: rows, startY: 25 });
            doc.save("Cloud_Report.pdf");
        };
    </script>
</body>
</html>
