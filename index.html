<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Finance Pro Elite - AI Business Mind</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
    <style>
        :root { --primary: #1E3A8A; --success: #10B981; --danger: #EF4444; --warning: #F59E0B; --bg: #F3F4F6; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: #1E293B; height: 100vh; overflow: hidden; }

        .header { padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; background: white; border-bottom: 1px solid #E5E7EB; position: fixed; top: 0; width: 100%; z-index: 1000; }
        .scroller { position: fixed; top: 70px; bottom: 85px; width: 100%; overflow-y: auto; padding: 15px; }
        .scroller::-webkit-scrollbar { display: none; }

        /* Dashboard Card */
        .card-main { background: linear-gradient(135deg, #0F172A 0%, #1E3A8A 100%); color: white; border-radius: 28px; padding: 22px; box-shadow: 0 15px 30px rgba(0,0,0,0.15); margin-bottom: 20px; }
        .health-bar-bg { height: 10px; background: rgba(255,255,255,0.1); border-radius: 10px; margin: 15px 0; overflow: hidden; }
        .health-bar-fill { height: 100%; transition: 1s ease; border-radius: 10px; }

        /* Progress Colors */
        .prog-red { background: var(--danger); }
        .prog-yellow { background: var(--warning); }
        .prog-green { background: var(--success); }

        .grid-emi { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; }
        .emi-info { font-size: 11px; opacity: 0.8; }
        .emi-info b { display: block; font-size: 14px; color: #DBEAFE; margin-top: 2px; }

        /* AI Mind Box */
        .coach-card { background: white; border-radius: 20px; padding: 18px; display: flex; align-items: center; gap: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); margin-bottom: 15px; border-left: 6px solid #6366F1; }
        .sig-box { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; background: #EEF2FF; color: #6366F1; border: 2px solid #E0E7FF; }

        .top-filters { display: flex; gap: 5px; }
        .btn-top { padding: 6px 12px; border-radius: 8px; border: 1px solid #E5E7EB; background: #F9FAFB; font-size: 12px; font-weight: 600; cursor: pointer; }
        .btn-top.active { background: var(--primary); color: white; border-color: var(--primary); }

        .tx-item { background: white; padding: 16px; border-radius: 18px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #F1F5F9; }

        /* Navigation */
        .nav { position: fixed; bottom: 0; width: 100%; height: 80px; background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #E5E7EB; }
        .fab { width: 62px; height: 62px; background: var(--primary); color: white; border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 32px; transform: translateY(-22px); border: 6px solid var(--bg); box-shadow: 0 10px 20px rgba(30,58,138,0.3); cursor: pointer; }

        .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 2000; align-items: flex-end; backdrop-filter: blur(5px); }
        .sheet { background: white; width: 100%; padding: 25px; border-radius: 30px 30px 0 0; max-height: 85vh; overflow-y: auto; }
        input, select { width: 100%; padding: 16px; margin: 8px 0; background: #F9FAFB; border: 1px solid #E5E7EB; border-radius: 12px; font-size: 16px; outline: none; }
        .btn-action { width: 100%; padding: 18px; border: none; border-radius: 15px; background: var(--primary); color: white; font-weight: 700; font-size: 16px; cursor: pointer; }
        
        .big-amt { font-size: 24px; font-weight: 800; display: block; margin-top: 4px; }
    </style>
</head>
<body>

    <div class="header">
        <div style="display:flex; align-items:center; gap:10px;">
            <div style="width:38px; height:38px; border-radius:10px; background:var(--primary); color:white; display:flex; align-items:center; justify-content:center; font-weight:bold;">SB</div>
            <div><b style="font-size:15px;">Finance AI</b></div>
        </div>
        <div class="top-filters">
            <button class="btn-top active" id="f-today" onclick="window.setFilter('today', this)">Today</button>
            <button class="btn-top" id="f-month" onclick="window.setFilter('month', this)">Month</button>
            <button class="btn-top" onclick="window.downloadReport()"><span class="material-symbols-rounded" style="font-size:18px;">download</span></button>
        </div>
    </div>

    <div class="scroller">
        <div class="card-main">
            <small style="opacity:0.7; letter-spacing:1px; font-weight:bold;">DAILY NET PROFIT</small>
            <h1 id="net-display" style="font-size:42px; margin:5px 0;">‚Çπ0</h1>
            
            <div class="health-bar-bg"><div id="health-fill" class="health-bar-fill"></div></div>
            <div style="display:flex; justify-content:space-between; font-size:12px; font-weight:500;">
                <span id="target-info">Target: ‚Çπ0</span>
                <span id="health-status">Business Health</span>
            </div>
            
            <div id="emi-summary" class="grid-emi"></div>
        </div>

        <div class="coach-card">
            <div class="sig-box"><span class="material-symbols-rounded">psychology</span></div>
            <div style="flex:1;">
                <b id="coach-title" style="color:#4F46E5;">AI Business Mind</b><br>
                <small id="coach-msg" style="color:#4B5563; font-size:13px; line-height:1.4;">Checking your patterns...</small>
                <div id="ai-urgent-amt" class="big-amt"></div>
            </div>
        </div>

        <div style="background:white; border-radius:24px; padding:12px; margin-bottom:15px;">
            <canvas id="profitChart" height="140"></canvas>
        </div>

        <div id="tx-history-list"></div>
    </div>

    <div class="nav">
        <div onclick="window.openSettings()"><span class="material-symbols-rounded" style="font-size:30px; color:gray;">account_balance_wallet</span></div>
        <div class="fab" onclick="window.openEntry()">+</div>
        <div onclick="alert('Analysis Coming Soon!')"><span class="material-symbols-rounded" style="font-size:30px; color:gray;">insights</span></div>
    </div>

    <div id="entrySheet" class="overlay">
        <div class="sheet">
            <h3>New Transaction</h3>
            <select id="typeIn" onchange="window.updateCats()">
                <option value="earning">üí∞ Sawari / Income</option>
                <option value="expense">üí∏ Kharcha / Expense</option>
            </select>
            <input type="number" id="amtIn" placeholder="‚Çπ Amount" inputmode="decimal">
            <select id="catIn"></select>
            <button class="btn-action" onclick="window.saveData()">SAVE ENTRY</button>
            <p onclick="window.closeSheets()" style="text-align:center; margin-top:20px; color:gray; cursor:pointer;">Cancel</p>
        </div>
    </div>

    <div id="settingsSheet" class="overlay">
        <div class="sheet">
            <h3>Business Plan</h3>
            <label style="font-size:12px; font-weight:bold;">DAILY TARGET (‚Çπ)</label>
            <input type="number" id="dailyGoalIn" placeholder="e.g. 1500">
            <div style="display:flex; justify-content:space-between; margin-top:15px;">
                <label style="font-size:12px; font-weight:bold;">FIXED BILLS / EMI</label>
                <button onclick="window.addNewEmi()" style="background:none; border:none; color:var(--primary); font-weight:bold;">+ ADD</button>
            </div>
            <div id="emi-inputs"></div>
            <button class="btn-action" style="background:var(--success)" onclick="window.saveSettings()">UPDATE PLAN</button>
            <p onclick="window.closeSheets()" style="text-align:center; margin-top:20px; color:gray; cursor:pointer;">Close</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCq6ZTCMeAGhqKH7cZ3d8gn1JSjn7MFkHg",
            authDomain: "finance-pro-a58ef.firebaseapp.com",
            projectId: "finance-pro-a58ef",
            storageBucket: "finance-pro-a58ef.firebasestorage.app",
            messagingSenderId: "441176545235",
            appId: "1:441176545235:web:5aa38eaf789b6e5ce1c126"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let transactions = [];
        let filterMode = 'today';
        let chart = null;

        onSnapshot(query(collection(db, "transactions"), orderBy("timestamp", "desc")), (snap) => {
            transactions = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            render();
        });

        window.openEntry = () => { document.getElementById('entrySheet').style.display = 'flex'; window.updateCats(); };
        window.openSettings = () => {
            document.getElementById('settingsSheet').style.display = 'flex';
            document.getElementById('dailyGoalIn').value = localStorage.getItem('dailyGoal') || '';
            const container = document.getElementById('emi-inputs'); container.innerHTML = '';
            const emis = JSON.parse(localStorage.getItem('emis') || '[]');
            emis.forEach(e => window.addNewEmi(e.name, e.amount));
        };
        window.addNewEmi = (n='', a='') => {
            const div = document.createElement('div'); div.style.display = 'flex'; div.style.gap = '8px';
            div.innerHTML = `<input type="text" placeholder="Name" value="${n}" style="flex:2"><input type="number" placeholder="‚Çπ" value="${a}" style="flex:1">`;
            document.getElementById('emi-inputs').appendChild(div);
        };
        window.closeSheets = () => document.querySelectorAll('.overlay').forEach(s => s.style.display = 'none');
        window.setFilter = (m, b) => { filterMode = m; document.querySelectorAll('.btn-top').forEach(c => c.classList.remove('active')); b.classList.add('active'); render(); };
        
        window.updateCats = () => {
            const t = document.getElementById('typeIn').value;
            document.getElementById('catIn').innerHTML = t === 'earning' ? `<option value="üõ∫ Sawari">üõ∫ Sawari</option><option value="üí∞ Tip">üí∞ Tip</option>` : `<option value="‚õΩ Fuel">‚õΩ Fuel</option><option value="üõ†Ô∏è Repair">üõ†Ô∏è Repair</option><option value="üè† Ghar">üè† Ghar Kharch</option>`;
        };

        window.saveData = async () => {
            const a = parseFloat(document.getElementById('amtIn').value);
            if(!a) return;
            await addDoc(collection(db, "transactions"), { amount: a, type: document.getElementById('typeIn').value, category: document.getElementById('catIn').value, timestamp: new Date().toISOString() });
            document.getElementById('amtIn').value = ''; window.closeSheets();
        };

        window.saveSettings = () => {
            localStorage.setItem('dailyGoal', document.getElementById('dailyGoalIn').value);
            const emis = []; document.getElementById('emi-inputs').querySelectorAll('div').forEach(row => {
                const inp = row.querySelectorAll('input');
                if(inp[0].value) emis.push({ name: inp[0].value, amount: parseFloat(inp[1].value) || 0 });
            });
            localStorage.setItem('emis', JSON.stringify(emis)); window.closeSheets(); render();
        };

        window.downloadReport = () => {
            let csv = "Date,Category,Type,Amount\n";
            transactions.forEach(t => { csv += `${new Date(t.timestamp).toLocaleDateString()},${t.category},${t.type},${t.amount}\n`; });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a'); a.setAttribute('href', url); a.setAttribute('download', 'Report.csv'); a.click();
        };

        function render() {
            const list = document.getElementById('tx-history-list'); list.innerHTML = '';
            const todayStr = new Date().toDateString();
            const goal = parseFloat(localStorage.getItem('dailyGoal')) || 0;
            const emis = JSON.parse(localStorage.getItem('emis') || '[]');
            
            let todayInc = 0, todayExp = 0, totalDailyEmi = 0;
            emis.forEach(e => totalDailyEmi += (e.amount / 30));

            transactions.forEach(t => {
                const dt = new Date(t.timestamp);
                const isT = dt.toDateString() === todayStr;
                if(isT) { if(t.type === 'earning') todayInc += t.amount; else todayExp += t.amount; }

                if(filterMode === 'all' || (filterMode === 'today' && isT)) {
                    list.innerHTML += `<div class="tx-item"><div><b>${t.category}</b><br><small>${dt.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</small></div>
                        <b style="color:${t.type==='earning'?'var(--success)':'var(--danger)'}">‚Çπ${t.amount}</b></div>`;
                }
            });

            const dailyNet = todayInc - todayExp;
            document.getElementById('net-display').innerText = "‚Çπ" + dailyNet.toLocaleString('en-IN');
            document.getElementById('target-info').innerText = "Target: ‚Çπ" + goal;
            
            const bar = document.getElementById('health-fill');
            const aiMsg = document.getElementById('coach-msg');
            const aiAmt = document.getElementById('ai-urgent-amt');
            const statusText = document.getElementById('health-status');

            // AI LOGIC & PROGRESS BAR
            let progress = (todayInc / goal) * 100;
            if(progress > 100) progress = 100;

            if(todayInc === 0) {
                bar.className = 'health-bar-fill prog-red'; bar.style.width = '5%';
                aiMsg.innerText = "Suraj, aaj ki pehli sawari ka intezar hai. Shubh shuruaat karein!";
                aiAmt.innerText = ""; statusText.innerText = "Waiting...";
            } else if (todayInc < totalDailyEmi) {
                bar.className = 'health-bar-fill prog-red'; bar.style.width = progress + '%';
                aiMsg.innerText = "Dhyan dein! Abhi tak EMI ka kharcha bhi poora nahi hua. Agli trip jaldi pakdein.";
                aiAmt.innerHTML = `<span style="color:var(--danger)">‚Çπ${(totalDailyEmi - todayInc).toFixed(0)} more for EMI</span>`;
                statusText.innerText = "Critical";
            } else if (todayInc < goal) {
                bar.className = 'health-bar-fill prog-yellow'; bar.style.width = progress + '%';
                aiMsg.innerText = "EMI cover ho gayi hai! Ab thoda aur dum lagaiye target poora karne ke liye.";
                aiAmt.innerHTML = `<span style="color:var(--warning)">‚Çπ${(goal - todayInc).toFixed(0)} to Goal</span>`;
                statusText.innerText = "Good";
            } else {
                bar.className = 'health-bar-fill prog-green'; bar.style.width = '100%';
                aiMsg.innerText = "Shandar! Target poora hua. Aaj aapne profitable business kiya hai. Ghar jaiye ya extra kamaiye!";
                aiAmt.innerHTML = `<span style="color:var(--success)">Target Done! +‚Çπ${(todayInc - goal).toFixed(0)}</span>`;
                statusText.innerText = "Excellent";
            }
            updateChart();
        }

        function updateChart() {
            const ctx = document.getElementById('profitChart');
            const days = []; const data = [];
            for(let i=6; i>=0; i--) {
                const d = new Date(); d.setDate(d.getDate() - i);
                days.push(d.toLocaleDateString('en-IN', {weekday:'short'}));
                let n = 0; transactions.forEach(t => { if(new Date(t.timestamp).toDateString() === d.toDateString()) n += (t.type==='earning'?t.amount:-t.amount); });
                data.push(n);
            }
            if(chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line', data: { labels: days, datasets: [{ data, borderColor: '#6366F1', tension: 0.4, fill: true, backgroundColor: 'rgba(99,102,241,0.1)', borderWidth: 3, pointRadius: 4 }] },
                options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false } } } }
            });
        }
    </script>
</body>
</html>
