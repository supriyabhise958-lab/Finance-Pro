<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Finance Pro Elite - Final Master</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
    <style>
        :root { --primary: #1E3A8A; --success: #10B981; --danger: #EF4444; --warning: #F59E0B; --bg: #F3F4F6; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: #1E293B; height: 100vh; overflow: hidden; }

        .header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: white; border-bottom: 1px solid #E5E7EB; position: fixed; top: 0; width: 100%; z-index: 1000; }
        .scroller { position: fixed; top: 70px; bottom: 85px; width: 100%; overflow-y: auto; padding: 15px; }
        .scroller::-webkit-scrollbar { display: none; }

        /* Premium Dashboard Card */
        .card-main { background: linear-gradient(135deg, #1E3A8A 0%, #0F172A 100%); color: white; border-radius: 28px; padding: 22px; box-shadow: 0 15px 30px rgba(0,0,0,0.15); margin-bottom: 20px; }
        .health-bar-bg { height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; margin: 15px 0; overflow: hidden; }
        .health-bar-fill { height: 100%; transition: 1s ease; }

        .grid-emi { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; }
        .emi-info { font-size: 11px; opacity: 0.8; }
        .emi-info b { display: block; font-size: 14px; color: #DBEAFE; margin-top: 2px; }

        /* AI Signal Box */
        .coach-card { background: white; border-radius: 20px; padding: 18px; display: flex; align-items: center; gap: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); margin-bottom: 15px; border-left: 6px solid var(--primary); }
        .sig-box { width: 48px; height: 48px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 26px; }

        .chips { display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .chip { padding: 10px 20px; border-radius: 14px; background: white; border: 1px solid #E5E7EB; font-size: 13px; font-weight: 600; cursor: pointer; white-space: nowrap; }
        .chip.active { background: var(--primary); color: white; }

        .tx-item { background: white; padding: 16px; border-radius: 18px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #F1F5F9; }

        /* Navigation */
        .nav { position: fixed; bottom: 0; width: 100%; height: 80px; background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #E5E7EB; }
        .fab { width: 62px; height: 62px; background: var(--primary); color: white; border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 32px; transform: translateY(-22px); border: 6px solid var(--bg); box-shadow: 0 10px 20px rgba(30,58,138,0.3); cursor: pointer; }

        /* Sheets */
        .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 2000; align-items: flex-end; backdrop-filter: blur(5px); }
        .sheet { background: white; width: 100%; padding: 25px; border-radius: 30px 30px 0 0; max-height: 85vh; overflow-y: auto; }
        input, select { width: 100%; padding: 16px; margin: 8px 0; background: #F9FAFB; border: 1px solid #E5E7EB; border-radius: 12px; font-size: 16px; outline: none; }
        .btn-action { width: 100%; padding: 18px; border: none; border-radius: 15px; background: var(--primary); color: white; font-weight: 700; font-size: 16px; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="header">
        <div style="display:flex; align-items:center; gap:12px;">
            <div style="width:40px; height:40px; border-radius:12px; background:var(--primary); color:white; display:flex; align-items:center; justify-content:center; font-weight:bold;">SB</div>
            <div><b style="font-size:16px;">Finance Hub</b><br><small id="cur-date" style="color:gray; font-size:11px;"></small></div>
        </div>
        <span class="material-symbols-rounded" onclick="window.openSettings()" style="cursor:pointer; color:var(--primary); font-size:30px;">settings_suggest</span>
    </div>

    <div class="scroller">
        <div class="card-main">
            <small style="opacity:0.7; letter-spacing:1px;">TODAY'S NET PROFIT</small>
            <h1 id="net-display" style="font-size:38px; margin:5px 0;">‚Çπ0</h1>
            
            <div class="health-bar-bg"><div id="health-fill" class="health-bar-fill"></div></div>
            <div style="display:flex; justify-content:space-between; font-size:11px;">
                <span id="target-info">Target: ‚Çπ0</span>
                <span id="health-status">Business Status</span>
            </div>
            
            <div id="emi-summary" class="grid-emi"></div>
        </div>

        <div class="chips">
            <button class="chip active" onclick="window.setFilter('all', this)">All History</button>
            <button class="chip" onclick="window.setFilter('today', this)">Today</button>
            <button class="chip" onclick="window.setFilter('month', this)">This Month</button>
        </div>

        <div class="coach-card">
            <div id="coach-icon-bg" class="sig-box"><span id="coach-icon" class="material-symbols-rounded">psychology</span></div>
            <div style="flex:1;">
                <b id="coach-title">AI Advisor</b><br>
                <small id="coach-msg" style="color:gray; font-size:12px; line-height:1.3;">Analyzing your data...</small>
            </div>
        </div>

        <div style="background:white; border-radius:24px; padding:10px; margin-bottom:15px;">
            <canvas id="profitChart" height="140"></canvas>
        </div>

        <div id="tx-history-list"></div>
    </div>

    <div class="nav">
        <div onclick="window.setFilter('all')"><span class="material-symbols-rounded">dashboard</span></div>
        <div class="fab" onclick="window.openEntry()">+</div>
        <div onclick="window.openSettings()"><span class="material-symbols-rounded">account_balance_wallet</span></div>
    </div>

    <div id="entrySheet" class="overlay">
        <div class="sheet">
            <h3>Add Transaction</h3>
            <select id="typeIn" onchange="window.updateCats()">
                <option value="earning">üí∞ Income / Sawari</option>
                <option value="expense">üí∏ Expense / Kharcha</option>
            </select>
            <input type="number" id="amtIn" placeholder="Amount (‚Çπ)" inputmode="decimal">
            <select id="catIn"></select>
            <button class="btn-action" onclick="window.saveData()">CONFIRM SAVE</button>
            <p onclick="window.closeSheets()" style="text-align:center; margin-top:20px; color:gray; cursor:pointer;">Cancel</p>
        </div>
    </div>

    <div id="settingsSheet" class="overlay">
        <div class="sheet">
            <h3>Business Settings</h3>
            <label style="font-size:12px; font-weight:bold; color:var(--primary);">DAILY TARGET (‚Çπ)</label>
            <input type="number" id="dailyGoalIn" placeholder="Example: 1500">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:15px;">
                <label style="font-size:12px; font-weight:bold; color:var(--danger);">MONTHLY BILLS / EMI</label>
                <button onclick="window.addNewEmi()" style="background:none; border:none; color:var(--primary); font-weight:bold;">+ ADD NEW</button>
            </div>
            <div id="emi-inputs"></div>
            <button class="btn-action" style="background:var(--success)" onclick="window.saveSettings()">UPDATE PLAN</button>
            <p onclick="window.closeSheets()" style="text-align:center; margin-top:20px; color:gray; cursor:pointer;">Close</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCq6ZTCMeAGhqKH7cZ3d8gn1JSjn7MFkHg",
            authDomain: "finance-pro-a58ef.firebaseapp.com",
            projectId: "finance-pro-a58ef",
            storageBucket: "finance-pro-a58ef.firebasestorage.app",
            messagingSenderId: "441176545235",
            appId: "1:441176545235:web:5aa38eaf789b6e5ce1c126"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let transactions = [];
        let filterMode = 'all';
        let chart = null;

        document.getElementById('cur-date').innerText = new Date().toLocaleDateString('hi-IN', {day:'numeric', month:'long'});

        onSnapshot(query(collection(db, "transactions"), orderBy("timestamp", "desc")), (snap) => {
            transactions = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            render();
        });

        // Global functions for HTML Buttons
        window.openEntry = () => { document.getElementById('entrySheet').style.display = 'flex'; window.updateCats(); };
        window.openSettings = () => {
            document.getElementById('settingsSheet').style.display = 'flex';
            document.getElementById('dailyGoalIn').value = localStorage.getItem('dailyGoal') || '';
            const container = document.getElementById('emi-inputs'); container.innerHTML = '';
            const emis = JSON.parse(localStorage.getItem('emis') || '[]');
            if(emis.length === 0) window.addNewEmi('Auto EMI', 0);
            else emis.forEach(e => window.addNewEmi(e.name, e.amount));
        };
        window.addNewEmi = (n='', a='') => {
            const div = document.createElement('div'); div.style.display = 'flex'; div.style.gap = '8px';
            div.innerHTML = `<input type="text" placeholder="Name" value="${n}" style="flex:2"><input type="number" placeholder="‚Çπ" value="${a}" style="flex:1"><button onclick="this.parentElement.remove()" style="border:none; background:none; color:red; font-weight:bold;">√ó</button>`;
            document.getElementById('emi-inputs').appendChild(div);
        };
        window.closeSheets = () => document.querySelectorAll('.overlay').forEach(s => s.style.display = 'none');
        window.setFilter = (m, b) => { filterMode = m; if(b) { document.querySelectorAll('.chip').forEach(c => c.classList.remove('active')); b.classList.add('active'); } render(); };
        window.updateCats = () => {
            const t = document.getElementById('typeIn').value;
            document.getElementById('catIn').innerHTML = t === 'earning' ? `<option value="üõ∫ Sawari">üõ∫ Sawari</option><option value="üí∞ Tip">üí∞ Tip</option>` : `<option value="‚õΩ Fuel">‚õΩ Fuel</option><option value="üõ†Ô∏è Repair">üõ†Ô∏è Repair</option><option value="üç≤ Food">üç≤ Food</option><option value="üè† Ghar">üè† Ghar Kharch</option>`;
        };
        window.saveData = async () => {
            const a = parseFloat(document.getElementById('amtIn').value);
            if(!a) return;
            await addDoc(collection(db, "transactions"), { amount: a, type: document.getElementById('typeIn').value, category: document.getElementById('catIn').value, timestamp: new Date().toISOString() });
            document.getElementById('amtIn').value = ''; window.closeSheets();
        };
        window.saveSettings = () => {
            localStorage.setItem('dailyGoal', document.getElementById('dailyGoalIn').value);
            const emis = []; document.getElementById('emi-inputs').querySelectorAll('div').forEach(row => {
                const inp = row.querySelectorAll('input');
                if(inp[0].value) emis.push({ name: inp[0].value, amount: parseFloat(inp[1].value) || 0 });
            });
            localStorage.setItem('emis', JSON.stringify(emis)); window.closeSheets(); render();
        };
        window.deleteTx = async (id) => { if(confirm("Delete this?")) await deleteDoc(doc(db, "transactions", id)); };

        function render() {
            const list = document.getElementById('tx-history-list'); list.innerHTML = '';
            const todayStr = new Date().toDateString();
            const thisMonth = new Date().getMonth();
            const goal = parseFloat(localStorage.getItem('dailyGoal')) || 0;
            const emis = JSON.parse(localStorage.getItem('emis') || '[]');
            
            let todayInc = 0, todayExp = 0, totalNet = 0, totalDailyEmi = 0;

            const emiSummary = document.getElementById('emi-summary'); emiSummary.innerHTML = '';
            emis.forEach(e => {
                const d = e.amount / 30; totalDailyEmi += d;
                emiSummary.innerHTML += `<div class="emi-info">${e.name} Share<b>‚Çπ${d.toFixed(0)}</b></div>`;
            });

            transactions.forEach(t => {
                const dt = new Date(t.timestamp);
                const isT = dt.toDateString() === todayStr;
                const isM = dt.getMonth() === thisMonth;
                
                if(t.type === 'earning') { totalNet += t.amount; if(isT) todayInc += t.amount; }
                else { totalNet -= t.amount; if(isT) todayExp += t.amount; }

                if(filterMode === 'all' || (filterMode === 'today' && isT) || (filterMode === 'month' && isM)) {
                    list.innerHTML += `<div class="tx-item"><div><b>${t.category}</b><br><small style="color:gray;">${dt.toLocaleDateString()}</small></div>
                        <div style="display:flex; align-items:center; gap:12px;"><b style="color:${t.type==='earning'?'var(--success)':'var(--danger)'}">‚Çπ${t.amount}</b>
                        <span class="material-symbols-rounded" onclick="deleteTx('${t.id}')" style="color:#CBD5E1; cursor:pointer;">delete</span></div></div>`;
                }
            });

            // Advanced AI Logic
            const dailyNet = todayInc - todayExp;
            document.getElementById('net-display').innerText = "‚Çπ" + dailyNet.toLocaleString('en-IN');
            document.getElementById('target-info').innerText = "Target: ‚Çπ" + goal;
            
            const bar = document.getElementById('health-fill');
            const coachT = document.getElementById('coach-title');
            const coachM = document.getElementById('coach-msg');
            const coachB = document.getElementById('coach-icon-bg');

            if(todayInc === 0) {
                bar.style.width = '10%'; bar.style.background = '#94A3B8';
                coachT.innerText = 'Ready to Start?'; coachM.innerText = 'Suraj, aaj ka kaam shuru karein. Shubh Din!';
                coachB.style.background = '#F1F5F9'; coachB.style.color = '#475569';
            } else if(todayInc < totalDailyEmi) {
                bar.style.width = '35%'; bar.style.background = 'var(--danger)';
                coachT.innerText = 'EMI Target Pending'; coachM.innerText = `EMI poori karne ke liye ‚Çπ${(totalDailyEmi - todayInc).toFixed(0)} aur kamao.`;
                coachB.style.background = '#FEF2F2'; coachB.style.color = 'var(--danger)';
            } else if(todayInc < goal) {
                bar.style.width = '70%'; bar.style.background = 'var(--warning)';
                coachT.innerText = 'Good Progress!'; coachM.innerText = `EMI cover ho gayi. Target ke liye ‚Çπ${(goal - todayInc).toFixed(0)} aur baaki hai.`;
                coachB.style.background = '#FFFBEB'; coachB.style.color = 'var(--warning)';
            } else {
                bar.style.width = '100%'; bar.style.background = 'var(--success)';
                coachT.innerText = 'Target Achieved! üöÄ'; coachM.innerText = `Mubarak ho! Aaj aapne ‚Çπ${dailyNet} ka shuddh munafa kamaya hai.`;
                coachB.style.background = '#DCFCE7'; coachB.style.color = 'var(--success)';
            }
            updateChart();
        }

        function updateChart() {
            const ctx = document.getElementById('profitChart');
            const days = []; const data = [];
            for(let i=6; i>=0; i--) {
                const d = new Date(); d.setDate(d.getDate() - i);
                days.push(d.toLocaleDateString('hi-IN', {weekday:'short'}));
                let n = 0; transactions.forEach(t => { if(new Date(t.timestamp).toDateString() === d.toDateString()) n += (t.type==='earning'?t.amount:-t.amount); });
                data.push(n);
            }
            if(chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line', data: { labels: days, datasets: [{ data, borderColor: '#3B82F6', tension: 0.4, fill: true, backgroundColor: 'rgba(59,130,246,0.05)', borderWidth: 3, pointRadius: 0 }] },
                options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false } } } }
            });
        }
    </script>
</body>
</html>
               
